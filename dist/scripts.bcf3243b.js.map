{"version":3,"sources":["scripts/index.js"],"names":["action","document","querySelector","templateImageCard","templateImagePopup","container","popup","popupContainer","popupClose","loader","MAX_PAGE_IMAGES","loaderTimeout","initialState","disabled","getPictures","page","limit","showLoader","fetch","then","response","json","result","renderPictures","getPictureInfo","id","renderPopupPicture","style","visibility","hideLoader","setTimeout","clearTimeout","cropImage","src","size","split","splice","domain","key","width","height","newWidth","Math","floor","newHeight","list","length","Error","link","content","image","fragment","createDocumentFragment","forEach","element","href","url","dataset","download_url","alt","author","clone","cloneNode","appendChild","picture","img","textContent","parentNode","classList","remove","add","innerHTML","togglePopup","toggle","actionHandler","evt","preventDefault","nextPage","currentTarget","console","warn","imageHandler","target","closest","addEventListener"],"mappings":"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","file":"scripts.bcf3243b.js","sourceRoot":"..\\src","sourcesContent":["\"use strict\";\r\n\r\nconst action = document.querySelector(\".action\");\r\nconst templateImageCard = document.querySelector(\"#image\");\r\nconst templateImagePopup = document.querySelector(\"#popup-image\");\r\nconst container = document.querySelector(\".images\");\r\n\r\nconst popup = document.querySelector(\".popup\");\r\nconst popupContainer = document.querySelector(\".popup .content\");\r\nconst popupClose = document.querySelector(\".popup .action\");\r\nconst loader = document.querySelector(\".loader\");\r\n\r\nconst MAX_PAGE_IMAGES = 34;\r\nlet loaderTimeout;\r\n\r\n/**\r\n * Функция задаёт первоначальное состояние страницы.\r\n * Отправляется первый запрос за картинками, юез параметров т.к. с дефолтными настройками.\r\n */\r\nconst initialState = function() {\r\n  action.disabled = false;\r\n  getPictures();\r\n};\r\n\r\n/**\r\n * Функция запрашивает картинки для галереи\r\n * и вызывает ф-цию отрисовки полученных картинок\r\n * @param {number} page\r\n * @param {number} limit\r\n */\r\nconst getPictures = function(page = 1, limit = 10) {\r\n  showLoader();\r\n  fetch(`https://picsum.photos/v2/list?page=${page};limit=${limit}`)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(result) {\r\n      renderPictures(result);\r\n    });\r\n};\r\n\r\n/**\r\n * Функция запрашивает информацию о конкретной картинке по её id\r\n * и вызывает ф-цию для отрисовки картинки в попапе\r\n * @param {number} id\r\n */\r\nconst getPictureInfo = function(id = 0) {\r\n  showLoader();\r\n  fetch(`https://picsum.photos/id/${id}/info`)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(result) {\r\n      renderPopupPicture(result);\r\n    });\r\n};\r\n\r\n/**\r\n * Функция показывает индикатор загрузки.\r\n * Меняет ситили, ничего не возвращает.\r\n */\r\nconst showLoader = function() {\r\n  loader.style.visibility = \"visible\";\r\n};\r\n\r\n/**\r\n * Функция скрывает индикатор загрузки.\r\n * Удаляет таймаут индикатора, ничего не возвращает.\r\n */\r\nconst hideLoader = function() {\r\n  loaderTimeout = setTimeout(function() {\r\n    loader.style.visibility = \"hidden\";\r\n    clearTimeout(loaderTimeout);\r\n  }, 700);\r\n};\r\n\r\n/**\r\n * Функция пропорционально делит размер картинки,\r\n * чтобы в превью не загружать слишком большие картинки,\r\n * которые возвращает сервис\r\n * @param {string} src\r\n * @param {number} size\r\n */\r\nconst cropImage = function(src, size = 2) {\r\n  const [domain, key, id, width, height] = src.split(\"/\").splice(2);\r\n  const newWidth = Math.floor(+width / size);\r\n  const newHeight = Math.floor(+height / size);\r\n\r\n  return `https://${domain}/${key}/${id}/${newWidth}/${newHeight}`;\r\n};\r\n\r\n/**\r\n * Функция копирует шаблон для каждой картинки,\r\n * заполняет его и встраивает в разметку\r\n * @param {array} list\r\n */\r\nconst renderPictures = function(list) {\r\n  if (!list.length) {\r\n    throw Error(`Pictures not defined. The list length: ${list.length}`);\r\n  }\r\n\r\n  const link = templateImageCard.content.querySelector(\"a\");\r\n  const image = templateImageCard.content.querySelector(\"img\");\r\n  const fragment = document.createDocumentFragment();\r\n\r\n  list.forEach(function(element) {\r\n    link.href = element.url;\r\n    link.dataset.id = element.id;\r\n\r\n    image.src = cropImage(element.download_url, 5);\r\n    image.alt = element.author;\r\n    // image.classList.add(\"preview\");\r\n    let clone = templateImageCard.content.cloneNode(true);\r\n    fragment.appendChild(clone);\r\n  });\r\n\r\n  container.appendChild(fragment);\r\n  hideLoader();\r\n};\r\n\r\n/**\r\n * Функция копирует шаблон для картинки в попапе,\r\n * заполняет его и встраивает в попап\r\n * @param {object} picture\r\n */\r\nconst renderPopupPicture = function(picture) {\r\n  const img = templateImagePopup.content.querySelector(\"img\");\r\n  const link = templateImagePopup.content.querySelector(\"a\");\r\n  const author = templateImagePopup.content.querySelector(\".author\");\r\n\r\n  img.src = cropImage(picture.download_url, 2);\r\n  img.alt = picture.author;\r\n  author.textContent = picture.author;\r\n\r\n  // Позволяет вертикальным картинкам не выходить за высоту контейнера\r\n  img.parentNode.classList.remove(\"vertical\");\r\n  if (picture.height > picture.width) {\r\n    img.parentNode.classList.add(\"vertical\");\r\n  }\r\n\r\n  img.width = picture.width / 10;\r\n  link.href = picture.download_url;\r\n\r\n  popupContainer.innerHTML = \"\";\r\n  let clone = templateImagePopup.content.cloneNode(true);\r\n  popupContainer.appendChild(clone);\r\n  hideLoader();\r\n  togglePopup();\r\n};\r\n\r\n/**\r\n * Функция переклбчает класс открытия на попапе\r\n */\r\nconst togglePopup = function() {\r\n  popup.classList.toggle(\"open\");\r\n};\r\n\r\n/**\r\n * @type {object} MouseEvent\r\n */\r\n\r\n/**\r\n * Обработчик кнопки подгрузки картинок\r\n * @param {MouseEvent} evt\r\n */\r\nconst actionHandler = function(evt) {\r\n  evt.preventDefault();\r\n  const nextPage = evt.currentTarget.dataset.page;\r\n  evt.currentTarget.dataset.page = +nextPage + 1;\r\n  debugger;\r\n\r\n  if (nextPage > MAX_PAGE_IMAGES) {\r\n    console.warn(\r\n      `WARN: You are trying to call a page that exceeds ${MAX_PAGE_IMAGES}`\r\n    );\r\n    evt.currentTarget.disabled = true;\r\n  } else {\r\n    getPictures(nextPage);\r\n  }\r\n};\r\n\r\n/**\r\n * Обработчик события click по картинкам.\r\n * Запрашивает данные по картинке, на которую кликнули,\r\n * для открытия попапа с ней\r\n * @param {MouseEvent} evt\r\n */\r\nconst imageHandler = function(evt) {\r\n  evt.preventDefault();\r\n\r\n  if (evt.target.closest(\"a\")) {\r\n    getPictureInfo(evt.target.parentNode.dataset.id);\r\n  }\r\n};\r\n\r\naction.addEventListener(\"click\", actionHandler);\r\ncontainer.addEventListener(\"click\", imageHandler);\r\npopupClose.addEventListener(\"click\", togglePopup);\r\n\r\ninitialState();\r\n"]}