{"version":3,"sources":["scripts/index.js"],"names":["loaderTimeout","action","document","querySelector","templateImageCard","templateImagePopup","container","popup","popupContainer","popupClose","loader","MAX_PAGE_IMAGES","initialState","disabled","getPictures","page","limit","showLoader","fetch","then","response","json","result","renderPictures","getPictureInfo","id","renderPopupPicture","style","visibility","hideLoader","setTimeout","clearTimeout","cropImage","src","size","split","splice","domain","key","width","height","newWidth","Math","floor","newHeight","list","length","Error","link","content","image","fragment","createDocumentFragment","forEach","element","href","url","dataset","download_url","alt","author","clone","cloneNode","appendChild","picture","img","textContent","parentNode","classList","remove","add","innerHTML","togglePopup","toggle","actionHandler","evt","preventDefault","nextPage","currentTarget","console","warn","imageHandler","target","closest","addEventListener"],"mappings":"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","file":"scripts.6cca3d0f.js","sourceRoot":"..\\src","sourcesContent":["\"use strict\";\r\n\r\nconst action = document.querySelector(\".action\");\r\nconst templateImageCard = document.querySelector(\"#image\");\r\nconst templateImagePopup = document.querySelector(\"#popup-image\");\r\nconst container = document.querySelector(\".images\");\r\n\r\nconst popup = document.querySelector(\".popup\");\r\nconst popupContainer = document.querySelector(\".popup .content\");\r\nconst popupClose = document.querySelector(\".popup .action\");\r\nconst loader = document.querySelector(\".loader\");\r\n\r\nconst MAX_PAGE_IMAGES = 34;\r\nlet loaderTimeout;\r\n\r\n/**\r\n * Функция задаёт первоначальное состояние страницы.\r\n * Отправляется первый запрос за картинками, юез параметров т.к. с дефолтными настройками.\r\n */\r\nconst initialState = function() {\r\n  action.disabled = false;\r\n  getPictures();\r\n};\r\n\r\n/**\r\n * Функция запрашивает картинки для галереи\r\n * и вызывает ф-цию отрисовки полученных картинок\r\n * @param {number} page\r\n * @param {number} limit\r\n */\r\nconst getPictures = function(page = 1, limit = 10) {\r\n  showLoader();\r\n  fetch(`https://picsum.photos/v2/list?page=${page};limit=${limit}`)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(result) {\r\n      renderPictures(result);\r\n    });\r\n};\r\n\r\n/**\r\n * Функция запрашивает информацию о конкретной картинке по её id\r\n * и вызывает ф-цию для отрисовки картинки в попапе\r\n * @param {number} id\r\n */\r\nconst getPictureInfo = function(id = 0) {\r\n  showLoader();\r\n  fetch(`https://picsum.photos/id/${id}/info`)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(result) {\r\n      renderPopupPicture(result);\r\n    });\r\n};\r\n\r\n/**\r\n * Функция показывает индикатор загрузки.\r\n * Меняет ситили, ничего не возвращает.\r\n */\r\nconst showLoader = function() {\r\n  loader.style.visibility = \"visible\";\r\n};\r\n\r\n/**\r\n * Функция скрывает индикатор загрузки.\r\n * Удаляет таймаут индикатора, ничего не возвращает.\r\n */\r\nconst hideLoader = function() {\r\n  loaderTimeout = setTimeout(function() {\r\n    loader.style.visibility = \"hidden\";\r\n    clearTimeout(loaderTimeout);\r\n  }, 700);\r\n};\r\n\r\n/**\r\n * Функция пропорционально делит размер картинки,\r\n * чтобы в превью не загружать слишком большие картинки,\r\n * которые возвращает сервис\r\n * @param {string} src\r\n * @param {number} size\r\n */\r\nconst cropImage = function(src, size = 2) {\r\n  const [domain, key, id, width, height] = src.split(\"/\").splice(2);\r\n  const newWidth = Math.floor(+width / size);\r\n  const newHeight = Math.floor(+height / size);\r\n\r\n  return `https://${domain}/${key}/${id}/${newWidth}/${newHeight}`;\r\n};\r\n\r\n/**\r\n * Функция копирует шаблон для каждой картинки,\r\n * заполняет его и встраивает в разметку\r\n * @param {array} list\r\n */\r\nconst renderPictures = function(list) {\r\n  if (!list.length) {\r\n    throw Error(`Pictures not defined. The list length: ${list.length}`);\r\n  }\r\n\r\n  const link = templateImageCard.content.querySelector(\"a\");\r\n  const image = templateImageCard.content.querySelector(\"img\");\r\n  const fragment = document.createDocumentFragment();\r\n\r\n  list.forEach(function(element) {\r\n    link.href = element.url;\r\n    link.dataset.id = element.id;\r\n\r\n    image.src = cropImage(element.download_url, 5);\r\n    image.alt = element.author;\r\n    // image.classList.add(\"preview\");\r\n    let clone = templateImageCard.content.cloneNode(true);\r\n    fragment.appendChild(clone);\r\n  });\r\n\r\n  container.appendChild(fragment);\r\n  hideLoader();\r\n};\r\n\r\n/**\r\n * Функция копирует шаблон для картинки в попапе,\r\n * заполняет его и встраивает в попап\r\n * @param {object} picture\r\n */\r\nconst renderPopupPicture = function(picture) {\r\n  const img = templateImagePopup.content.querySelector(\"img\");\r\n  const link = templateImagePopup.content.querySelector(\"a\");\r\n  const author = templateImagePopup.content.querySelector(\".author\");\r\n\r\n  img.src = cropImage(picture.download_url, 2);\r\n  img.alt = picture.author;\r\n  author.textContent = picture.author;\r\n\r\n  // Позволяет вертикальным картинкам не выходить за высоту контейнера\r\n  img.parentNode.classList.remove(\"vertical\");\r\n  if (picture.height > picture.width) {\r\n    img.parentNode.classList.add(\"vertical\");\r\n  }\r\n\r\n  img.width = picture.width / 10;\r\n  link.href = picture.download_url;\r\n\r\n  popupContainer.innerHTML = \"\";\r\n  let clone = templateImagePopup.content.cloneNode(true);\r\n  popupContainer.appendChild(clone);\r\n  hideLoader();\r\n  togglePopup();\r\n};\r\n\r\n/**\r\n * Функция переклбчает класс открытия на попапе\r\n */\r\nconst togglePopup = function() {\r\n  popup.classList.toggle(\"open\");\r\n};\r\n\r\n/**\r\n * @type {object} MouseEvent\r\n */\r\n\r\n/**\r\n * Обработчик кнопки подгрузки картинок\r\n * @param {MouseEvent} evt\r\n */\r\nconst actionHandler = function(evt) {\r\n  evt.preventDefault();\r\n  const nextPage = evt.currentTarget.dataset.page;\r\n  evt.currentTarget.dataset.page = +nextPage + 1;\r\n  debugger;\r\n\r\n  if (nextPage > MAX_PAGE_IMAGES) {\r\n    console.warn(\r\n      `WARN: You are trying to call a page that exceeds ${MAX_PAGE_IMAGES}`\r\n    );\r\n    evt.currentTarget.disabled = true;\r\n  } else {\r\n    getPictures(nextPage);\r\n  }\r\n};\r\n\r\n/**\r\n * Обработчик события click по картинкам.\r\n * Запрашивает данные по картинке, на которую кликнули,\r\n * для открытия попапа с ней\r\n * @param {MouseEvent} evt\r\n */\r\nconst imageHandler = function(evt) {\r\n  evt.preventDefault();\r\n\r\n  if (evt.target.closest(\"a\")) {\r\n    getPictureInfo(evt.target.parentNode.dataset.id);\r\n  }\r\n};\r\n\r\naction.addEventListener(\"click\", actionHandler);\r\ncontainer.addEventListener(\"click\", imageHandler);\r\npopupClose.addEventListener(\"click\", togglePopup);\r\n\r\ninitialState();\r\n"]}